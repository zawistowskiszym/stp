<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STP — System Monitorowania Ruchu</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --navy:#0b0f1a;
  --navy-2:#111827;
  --navy-3:#1a2236;
  --border:#1e2d47;
  --text:#d6dce8;
  --text-2:#8899b4;
  --text-3:#4d607d;
  --white:#f0f4fc;
  --blue:#2a6dd9;
  --green:#0fa86a;
  --yellow:#d4960a;
  --red:#c0282a;
  --mono:'IBM Plex Mono', monospace;
  --sans:'IBM Plex Sans', sans-serif;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:var(--sans);
  background:var(--navy);
  color:var(--text);
  font-size:13px;
}

header{
  height:56px;
  background:var(--navy-2);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}

h1{
  font-size:13px;
  letter-spacing:1px;
  color:var(--text-2);
  text-transform:uppercase;
}

.status{
  font-family:var(--mono);
  font-size:12px;
}

.table-wrap{
  height:calc(100vh - 56px);
  overflow:auto;
}

table{
  width:100%;
  border-collapse:collapse;
}

th, td{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
}

th{
  text-align:left;
  font-family:var(--mono);
  font-size:10px;
  letter-spacing:1px;
  color:var(--text-3);
  text-transform:uppercase;
}

tbody tr{
  cursor:pointer;
  transition:background .15s;
}

tbody tr:hover{
  background:rgba(42,109,217,.05);
}

.cell-route{
  font-family:var(--mono);
  font-size:14px;
  color:var(--white);
}

/* ===== DETAILS PANEL ===== */

.details-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  opacity:0;
  pointer-events:none;
  transition:.2s;
  z-index:10;
}

.details-overlay.active{
  opacity:1;
  pointer-events:auto;
}

.details-panel{
  position:fixed;
  top:0;
  right:-400px;
  width:380px;
  height:100%;
  background:var(--navy-2);
  border-left:1px solid var(--border);
  transition:right .25s ease;
  z-index:20;
  display:flex;
  flex-direction:column;
}

.details-panel.active{
  right:0;
}

.details-header{
  padding:20px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.details-line{
  font-family:var(--mono);
  font-size:20px;
  color:var(--white);
}

.details-dest{
  font-size:13px;
  color:var(--text-2);
}

.details-body{
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.details-label{
  font-family:var(--mono);
  font-size:9px;
  color:var(--text-3);
  text-transform:uppercase;
}

.details-value{
  font-size:13px;
  color:var(--text);
}

.details-close{
  background:none;
  border:1px solid var(--border);
  color:var(--text-2);
  padding:5px 10px;
  cursor:pointer;
}

.details-close:hover{
  border-color:var(--blue);
  color:var(--white);
}
</style>
</head>
<body>

<header>
  <h1>STP — System Monitorowania Ruchu</h1>
  <div class="status" id="status">ONLINE</div>
</header>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Linia</th>
<th>Kierunek</th>
<th>Następny przystanek</th>
<th>Opóźnienie</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="4">Ładowanie danych...</td></tr>
</tbody>
</table>
</div>

<!-- DETAILS -->
<div class="details-overlay" id="overlay" onclick="closeDetails()"></div>

<aside class="details-panel" id="panel">
<div class="details-header">
  <div>
    <div class="details-line" id="dRoute">—</div>
    <div class="details-dest" id="dDest">—</div>
  </div>
  <button class="details-close" onclick="closeDetails()">✕</button>
</div>

<div class="details-body">
  <div>
    <div class="details-label">Kierowca</div>
    <div class="details-value" id="dDriver">—</div>
  </div>

  <div>
    <div class="details-label">Status</div>
    <div class="details-value" id="dStatus">—</div>
  </div>

  <div>
    <div class="details-label">Następny przystanek</div>
    <div class="details-value" id="dStop">—</div>
  </div>

  <div>
    <div class="details-label">Opóźnienie (sekundy)</div>
    <div class="details-value" id="dDelay">—</div>
  </div>
</div>
</aside>

<script>
const API_URL = "https://stp.zawistowski-szym.workers.dev/api/buses";
let buses = [];

async function fetchData(){
  try{
    const res = await fetch(API_URL);
    const data = await res.json();
    buses = data.buses || [];
    renderTable();
    document.getElementById("status").textContent="ONLINE";
  }catch{
    document.getElementById("status").textContent="OFFLINE";
  }
}

function renderTable(){
  const tbody = document.getElementById("tableBody");
  if(!buses.length){
    tbody.innerHTML="<tr><td colspan='4'>Brak pojazdów</td></tr>";
    return;
  }

  tbody.innerHTML = buses.map((b,i)=>`
    <tr onclick="openDetails(${i})">
      <td class="cell-route">${b.routeNum || "—"}</td>
      <td>${b.destination || "—"}</td>
      <td>${b.currentStop || "—"}</td>
      <td>${b.delaySeconds ?? "0"} s</td>
    </tr>
  `).join("");
}

function openDetails(index){
  const b = buses[index];
  document.getElementById("dRoute").textContent = "Linia "+(b.routeNum||"—");
  document.getElementById("dDest").textContent = b.destination||"—";
  document.getElementById("dDriver").textContent = b.driverName||"—";
  document.getElementById("dStatus").textContent = b.doorsOpen ? "Drzwi otwarte" : "W trasie";
  document.getElementById("dStop").textContent = b.currentStop||"—";
  document.getElementById("dDelay").textContent = (b.delaySeconds ?? 0)+" s";

  document.getElementById("panel").classList.add("active");
  document.getElementById("overlay").classList.add("active");
}

function closeDetails(){
  document.getElementById("panel").classList.remove("active");
  document.getElementById("overlay").classList.remove("active");
}

document.addEventListener("keydown",e=>{
  if(e.key==="Escape") closeDetails();
});

fetchData();
setInterval(fetchData,15000);
</script>

</body>
</html>
